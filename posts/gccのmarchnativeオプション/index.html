<!doctype html><html lang=ja-jp><head><title>GCCã®march=nativeã‚ªãƒ—ã‚·ãƒ§ãƒ³ | ãŸãã®é›‘è¨˜å¸³</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="ã©ã†ã‚‚ï¼å…ˆç¨‹ #GentooInstallBattle ã‚’å§‹ã‚ã¾ã—ãŸï¼ ã¨ã“ã‚ã§ï¼Œgccã®-march=nativeã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ãŒï¼ŒCPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åˆã‚ã›ãŸæœ€é©åŒ–ã‚’ã™ã‚‹ã¨ã„ã†æ„"><meta name=generator content="Hugo 0.99.1"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://blog.orangepla.net/css/custom.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.4/css/all.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-QPZP852019"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QPZP852019",{anonymize_ip:!1})}</script><meta property="og:title" content="GCCã®march=nativeã‚ªãƒ—ã‚·ãƒ§ãƒ³"><meta property="og:description" content="ã©ã†ã‚‚ï¼å…ˆç¨‹ #GentooInstallBattle ã‚’å§‹ã‚ã¾ã—ãŸï¼ ã¨ã“ã‚ã§ï¼Œgccã®-march=nativeã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ãŒï¼ŒCPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åˆã‚ã›ãŸæœ€é©åŒ–ã‚’ã™ã‚‹ã¨ã„ã†æ„"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.orangepla.net/posts/gcc%E3%81%AEmarchnative%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-12-14T00:00:00+00:00"><meta property="article:modified_time" content="2017-12-14T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="GCCã®march=nativeã‚ªãƒ—ã‚·ãƒ§ãƒ³"><meta name=twitter:description content="ã©ã†ã‚‚ï¼å…ˆç¨‹ #GentooInstallBattle ã‚’å§‹ã‚ã¾ã—ãŸï¼ ã¨ã“ã‚ã§ï¼Œgccã®-march=nativeã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ãŒï¼ŒCPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åˆã‚ã›ãŸæœ€é©åŒ–ã‚’ã™ã‚‹ã¨ã„ã†æ„"></head><body><nav class=navigation><a href=/><span class=arrow>â†</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
<a class=button href=https://blog.orangepla.net/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>GCCã®march=nativeã‚ªãƒ—ã‚·ãƒ§ãƒ³</h1><div class=tip><time datetime="2017-12-14 00:00:00 +0000 UTC">Dec 14, 2017</time>
<span class=split>Â·</span>
<span>942 words</span>
<span class=split>Â·</span>
<span>2 minute read</span></div><div class=content><p>ã©ã†ã‚‚ï¼å…ˆç¨‹ #GentooInstallBattle ã‚’å§‹ã‚ã¾ã—ãŸï¼</p><p>ã¨ã“ã‚ã§ï¼Œgccã®-march=nativeã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ãŒï¼ŒCPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åˆã‚ã›ãŸæœ€é©åŒ–ã‚’ã™ã‚‹ã¨ã„ã†æ„å‘³ã§ã™ãŒï¼Œãã‚ŒãŒã©ã‚“ãªæ„Ÿã˜ã«å±•é–‹ã•ã‚Œã¦ã‚‹ã®ã‹æ°—ã«ãªã‚Šèª¿ã¹ã¦ã¿ã¾ã—ãŸï¼</p><h1 id=version-of-gcc>Version of GCC <a href=#version-of-gcc class=anchor>ğŸ”—</a></h1><pre tabindex=0><code>$ gcc --version
gcc (GCC) 7.2.1 20171128
Copyright (C) 2017 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</code></pre><h1 id=man-of-gccl18896>man of GCC(L:18896) <a href=#man-of-gccl18896 class=anchor>ğŸ”—</a></h1><pre tabindex=0><code>       -march=cpu-type
           Generate instructions for the machine type cpu-type.  In contrast to
           -mtune=cpu-type, which merely tunes the generated code for the specified cpu-
           type, -march=cpu-type allows GCC to generate code that may not run at all on
           processors other than the one indicated.  Specifying -march=cpu-type implies
           -mtune=cpu-type.

           The choices for cpu-type are:

           native
               This selects the CPU to generate code for at compilation time by
               determining the processor type of the compiling machine.  Using
               -march=native enables all instruction subsets supported by the local
               machine (hence the result might not run on different machines).  Using
               -mtune=native produces code optimized for the local machine under the
               constraints of the selected instruction set.
</code></pre><p>gccã¯ <strong>-march=native</strong> ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®CPUã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã‚‹ã™ã¹ã¦ã®instruction subsetsã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã§ã™ï¼</p><h1 id=-marchnative-ã®å±•é–‹>-march=native ã®å±•é–‹ <a href=#-marchnative-%e3%81%ae%e5%b1%95%e9%96%8b class=anchor>ğŸ”—</a></h1><p>-E -vã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ãˆã°ç°¡å˜ã«å‡ºæ¥ã¾ã—ãŸï¼</p><h3 id=-e>-E <a href=#-e class=anchor>ğŸ”—</a></h3><pre tabindex=0><code>       -E  Stop after the preprocessing stage; do not run the compiler proper.  The output
           is in the form of preprocessed source code, which is sent to the standard
           output.

           Input files that don&#39;t require preprocessing are ignored.
</code></pre><h3 id=-v>-v <a href=#-v class=anchor>ğŸ”—</a></h3><pre tabindex=0><code>       -v  Print (on standard error output) the commands executed to run the stages of
           compilation.  Also print the version number of the compiler driver program and
           of the preprocessor and the compiler proper.
</code></pre><p>ã¨ã„ã†ã“ã¨ã§ã©ã‚“ãªçµæœãŒå‡ºã‚‹ã®ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p><pre tabindex=0><code>$ echo | gcc -E -v -march=native - 2&gt;&amp;1 | grep cc1
 /usr/lib/gcc/x86_64-pc-linux-gnu/7.2.1/cc1 -E -quiet -v - -march=haswell -mmmx -mno-3dnow -msse -msse2 -msse3 -mssse3 -mno-sse4a -mcx16 -msahf -mmovbe -maes -mno-sha -mpclmul -mpopcnt -mabm -mno-lwp -mfma -mno-fma4 -mno-xop -mbmi -mno-sgx -mbmi2 -mno-tbm -mavx -mavx2 -msse4.2 -msse4.1 -mlzcnt -mno-rtm -mno-hle -mrdrnd -mf16c -mfsgsbase -mno-rdseed -mno-prfchw -mno-adx -mfxsr -mxsave -mxsaveopt -mno-avx512f -mno-avx512er -mno-avx512cd -mno-avx512pf -mno-prefetchwt1 -mno-clflushopt -mno-xsavec -mno-xsaves -mno-avx512dq -mno-avx512bw -mno-avx512vl -mno-avx512ifma -mno-avx512vbmi -mno-avx5124fmaps -mno-avx5124vnniw -mno-clwb -mno-mwaitx -mno-clzero -mno-pku -mno-rdpid --param l1-cache-size=32 --param l1-cache-line-size=64 --param l2-cache-size=6144 -mtune=haswell
</code></pre><p>ã“ã¡ã‚‰ãŒå¹³å¸¸æ™‚ã«ãªã‚Šã¾ã™ï¼</p><pre tabindex=0><code>$ echo | gcc -E -v  - 2&gt;&amp;1 | grep cc1
 /usr/lib/gcc/x86_64-pc-linux-gnu/7.2.1/cc1 -E -quiet -v - -mtune=generic -march=x86-64
</code></pre><p>ä¸Šã®2ã¤ã‚’æ¯”è¼ƒã—ã¦ã‚ã’ã‚‹ã¨ -march=native ã§ã©ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒè¿½åŠ ã•ã‚ŒãŸã‹ãŒã‚ã‹ã‚Šã¾ã™ï¼</p><pre tabindex=0><code>-march=haswell -mmmx -mno-3dnow -msse -msse2 -msse3 -mssse3 -mno-sse4a -mcx16 -msahf -mmovbe -maes -mno-sha -mpclmul -mpopcnt -mabm -mno-lwp -mfma -mno-fma4 -mno-xop -mbmi -mno-sgx -mbmi2 -mno-tbm -mavx -mavx2 -msse4.2 -msse4.1 -mlzcnt -mno-rtm -mno-hle -mrdrnd -mf16c -mfsgsbase -mno-rdseed -mno-prfchw -mno-adx -mfxsr -mxsave -mxsaveopt -mno-avx512f -mno-avx512er -mno-avx512cd -mno-avx512pf -mno-prefetchwt1 -mno-clflushopt -mno-xsavec -mno-xsaves -mno-avx512dq -mno-avx512bw -mno-avx512vl -mno-avx512ifma -mno-avx512vbmi -mno-avx5124fmaps -mno-avx5124vnniw -mno-clwb -mno-mwaitx -mno-clzero -mno-pku -mno-rdpid --param l1-cache-size=32 --param l1-cache-line-size=64 --param l2-cache-size=6144 -mtune=haswell
</code></pre><p>ã¡ã‚‡ã†ã©è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼</p><p>ã“ã‚Œã ã‘ã§ã¯é¢ç™½ããªã„ã®ã§ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã¦ã‚‹éƒ¨åˆ†ã®<a href=https://github.com/gcc-mirror/gcc/blob/7c42fa1ff01372e69104d72809d76e386254d6ff/gcc/config/i386/driver-i386.c target=_blank rel=noopener>ã‚½ãƒ¼ã‚¹</a>
ã‚’è¦‹ã«è¡Œãã¾ã—ã‚‡ã†ï¼</p><p>ã“ã‚Œã®381è¡Œç›® ** const char *host_detect_local_cpu (int argc, const char **argv) **ã§è¦‹ã‚Œã¾ã™ï¼ã‹ãªã‚Šæ°—åˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆã‚’ã—ã¦ã¾ã™ã®ã§è¦‹ã¦ã¿ã‚‹ã¨æ¥½ã—ã„ã§ã™ï¼
AArch64ã§ã¯ï¼Œå®Ÿã¯å†…éƒ¨ã§ ** f = fopen ("/proc/cpuinfo", &ldquo;r&rdquo;); ** ã‚’ã‚„ã£ã¦ ** /cpu/procinfo ** ã‚’èª­ã¿ã«è¡Œã£ã¦ã¦ï¼Œãã‚Œã‚’ã‚´ãƒ‹ãƒ§ã‚´ãƒ‹ãƒ§ã—ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã¦ã¾ã—ãŸï¼</p><p>** gcc/config/${arch}/driver-${arch}.c ** ã¨ã„ã†ã‚ˆã†ãªè¦å‰‡æ€§ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã®ã§ï¼Œä»–ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆã‚‚ã©ã†ã‚„ã£ã¦ã‚‹ã‹è¦‹ã¦æ¥½ã—ã‚€ã“ã¨ãŒã§ããã†ãªã®ã§ï¼Œãœã²çš†ã•ã‚“è¦‹ã¦ã¿ã¦ãã ã•ã„ï¼</p></div><div class=tags><a href=https://blog.orangepla.net/tags/gcc>GCC</a></div><section class="section sns_parent"><div class="container sns_section"><div class="sns_button twitter"><a href="http://twitter.com/intent/tweet?url=https%3a%2f%2fblog.orangepla.net%2fposts%2fgcc%25E3%2581%25AEmarchnative%25E3%2582%25AA%25E3%2583%2597%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3%2f&text=GCC%e3%81%aemarch%3dnative%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3" target=_blank title=Tweet><i class="fab fa-twitter"></i></a></div><div class="sns_button hatena"><a href="http://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fblog.orangepla.net%2fposts%2fgcc%25E3%2581%25AEmarchnative%25E3%2582%25AA%25E3%2583%2597%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3%2f&title=GCC%e3%81%aemarch%3dnative%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3" target=_blank title=hatena><i class="fa fa-hatena"></i></i></a></div><div class="sns_button facebook"><a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.orangepla.net%2fposts%2fgcc%25E3%2581%25AEmarchnative%25E3%2582%25AA%25E3%2583%2597%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3%2f&t=GCC%e3%81%aemarch%3dnative%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3" target=_blank title=Facebook><i class="fab fa-facebook"></i></a></div></div></section><div id=comment><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//orangeplanet.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></section></main><footer id=footer><div class=copyright>Â© Copyright
2023
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span>Takahiro KINOSHITA</div></footer></body></html>