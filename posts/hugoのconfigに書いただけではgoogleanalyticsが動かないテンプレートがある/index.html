<!doctype html><html lang=ja-jp><head><title>hugoのconfigに書いただけではGoogleAnalyticsが動かないテンプレートがある | たきの雑記帳</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="これまでブログはhatenaでやっていたのですが，ポートフォリオなどいろいろと付け足すと使い勝手が悪かったので，hugoで新築しました． その"><meta name=generator content="Hugo 0.99.1"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://blog.orangepla.net/css/custom.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.4/css/all.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-QPZP852019"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QPZP852019",{anonymize_ip:!1})}</script></head><body><nav class=navigation><a href=/><span class=arrow>←</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
<a class=button href=https://blog.orangepla.net/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>hugoのconfigに書いただけではGoogleAnalyticsが動かないテンプレートがある</h1><div class=tip><time datetime="2022-06-19 00:00:00 +0000 UTC">Jun 19, 2022</time>
<span class=split>·</span>
<span>726 words</span>
<span class=split>·</span>
<span>2 minute read</span></div><div class=content><p>これまでブログはhatenaでやっていたのですが，ポートフォリオなどいろいろと付け足すと使い勝手が悪かったので，hugoで新築しました．
その際にGoogleAnalyticsを設定しようとしたのですが，一発でうまく動作しませんでしたので，トラブルシュートの記録です．</p><p>HugoにはデフォルトでGoogleAnalyticsを簡単に設定するためのテンプレートが組み込まれています．
google_analytics_async.html と google_analytics.htmlの2種類が用意されています．</p><p>config.tomlにGoogleAnalyticsのトラッキングコードを書くことでトラッキング用の
Javascriptを読み込んでいい感じにしてくれるのですが，google_analytics_async.htmlの方では，GoogleAnalytics 4に対応していないので，google_analytics.htmlを使う必要があります．
使っていたテーマの<a href=https://github.com/nodejh/hugo-theme-mini target=_blank rel=noopener>hugo-theme-mini</a>では，head.htmlでansyncの方を読み込んでいたので，タグをconfig.tomlに書いてもうまく動作しませんでした．</p><p><code>/themes/mini/layout/partials/head.html</code>を
<code>/layouts/partial/head.html</code>にコピーして，google_analytics_async.htmlを読み込んでいる部分をgoogle_analytics.html書き換えればうごきます．</p><p>このテンプレートは，<a href=https://github.com/gohugoio/hugo/blob/master/tpl/tplimpl/embedded/templates/google_analytics.html target=_blank rel=noopener>ここ</a>で見れます．
タグのprefixでGoogleAnalyticsのバージョンを判別できるようで，prefixがUAかGかで読み込むスクリプトを変更するようになっていました．</p></div><div class=tags><a href=https://blog.orangepla.net/tags/hugo>hugo</a></div><div id=comment><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//orangeplanet.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></section></main><footer id=footer><div class=copyright>© Copyright
2022
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span>Takahiro KINOSHITA</div></footer></body></html>